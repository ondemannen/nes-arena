<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
</head>
<body>
<h1>Resultater - Nes Arena</h1>
Klasse: <select id="klasse"></select>
Øvelse: <select id="øvelse"></select>
<div id="resultat"></div>
</BODY>
</HTML>
<script>
$(document).ready(function() {
	var res = [];
	var a_class = [];
	var a_event = [];
	var a_name = [];
	var g_url = "nes-arena.json";
	$.getJSON( "ajax/test.json", function( data ) {
		var items = [];
		$.each( data, function( key, val ) {
			console.log(key,val);
		});
		var lines = rt.split(/\n/);
		console.log("Lines: " + lines.length);
		for(var i = 1; i < lines.length; i++) {
			var w = lines[i].split(/\t/);
			var tmp = {};
			tmp.stevne = w[0];
			tmp.dato = w[1];
			tmp.øvelse = w[2];
			tmp.klasse = w[3];
			tmp.årsklasse = w[4];
			tmp.navn = w[5];
			tmp.klubb = w[6];
			tmp.resultat = w[7];
			tmp.enhet = w[8];
			if($.inArray(tmp.øvelse,a_name) === -1) a_name.push(tmp.name);
			if($.inArray(tmp.øvelse,a_event) === -1) a_event.push(tmp.øvelse);
			if($.inArray(tmp.klasse,a_class) === -1) a_class.push(tmp.klasse);
			res.push(tmp);
		}
		var tmp = a_event.sort();
		for(var i = 0; i < tmp.length; i++) {
			$('select#øvelse').append($('<option>', {
				text : tmp[i],
				value: tmp[i],
			}));
		}
		var tmp = a_class.sort();
		for(var i = 0; i < tmp.length; i++) {
			$('select#klasse').append($('<option>', {
				text : tmp[i],
				value: tmp[i],
			}));
		}
	});
	v.onerror = function() { console.log('There was an error!'); };
	v.send();

	$("select#klasse").on("change", function(e) { find_best() });
	$("select#øvelse").on("change", function(e) { find_best() });
	function find_best() {
		var klasse = $("select#klasse :selected").text();
		var øvelse = $("select#øvelse :selected").text();
		var best = {};
		for(var i = 0 ; i < res.length; i++) {
			if(res[i].klasse == klasse && res[i].øvelse == øvelse) {
				if(!best.resultat) {
					best = res[i];
				} else if(res[i].enhet == 0)
					if(res[i].resultat < best.resultat)
						best = res[i];
				else if(res[i].enhet == 1)
					if(res[i].resultat > best.resultat)
						best = res[i];
				console.log(res[i].navn, best.navn)
			}
		}
		if(best.navn) {
			$('div#resultat').html(
				'<table>' +
				'<tr><td><b>Navn</td><td>' + best.navn + '</td></tr>' +
				'<tr><td><b>Klubb</td><td>' + best.klubb + '</td></tr>' +
				'<tr><td><b>Resultat</td><td>' + best.resultat + '</td></tr>' +
				'<tr><td><b>Stevne</td><td>' + best.stevne + '</td></tr>' +
				'</table>'
			);
		} else {
			$('div#resultat').text('Mangler deltaker');
		}
	}
	$("select#klasse").change();
}); 
</script>