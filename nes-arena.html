<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
</head>
<body>
<h1>Resultater - Nes Arena</h1>
Klasse: <select id="klasse"><option>Velg klasse</option></select>
Øvelse: <select id="øvelse"><option>Velg øvelse</option></select>
<div id="resultat"></div>
</BODY>
</HTML>
<script>
$(document).ready(function() {
	var res = [];
	var a_class = [];
	var a_event = [];
	var a_name = [];
	var g_url = "nes-arena.json";
	$.getJSON(g_url, function( data ) {
		var items = [];
		$.each( data, function( key, val ) {
			if($.inArray(val.navn,a_name) === -1) a_name.push(val.navn);
			if($.inArray(val.øvelse,a_event) === -1) a_event.push(val.øvelse);
			if($.inArray(val.klasse,a_class) === -1) a_class.push(val.klasse);
			res.push(val);
		});
		var tmp = a_event.sort();
		for(var i = 0; i < tmp.length; i++) $('select#øvelse').append($('<option>', { text : tmp[i] }));

		var tmp = a_class.sort();
		for(var i = 0; i < tmp.length; i++) $('select#klasse').append($('<option>', { text : tmp[i] }));

	});

	$("select#klasse").on("change", function(e) { find_best() });
	$("select#øvelse").on("change", function(e) { find_best() });
	function find_best() {
		var klasse = $("select#klasse :selected").text();
		var øvelse = $("select#øvelse :selected").text();
		//console.log(klasse,øvelse);
		var best = {};
		for(var i = 0 ; i < res.length; i++) {
			if(res[i].klasse == klasse && res[i].øvelse == øvelse) {
				if(!best.resultat) {
					best = res[i];
				} else if(res[i].enhet == 0)
					if(res[i].resultat < best.resultat)
						best = res[i];
				else if(res[i].enhet == 1)
					if(res[i].resultat > best.resultat)
						best = res[i];
			}
		}
		if(best.navn) {
			$('div#resultat').html(
				'<table>' +
				'<tr><td><b>Navn</td><td>' + best.navn + '</td></tr>' +
				'<tr><td><b>Klubb</td><td>' + best.klubb + '</td></tr>' +
				'<tr><td><b>Resultat</td><td>' + best.resultat + '</td></tr>' +
				'<tr><td><b>Stevne</td><td>' + best.stevne + '</td></tr>' +
				'</table>'
			);
		} else {
			$('div#resultat').text('Mangler deltaker');
		}
	}
	find_best();
}); 
</script>